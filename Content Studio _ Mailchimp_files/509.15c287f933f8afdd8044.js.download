(window.webpackJsonp=window.webpackJsonp||[]).push([[509],{1216:function(e,t,n){"use strict";n.r(t);var a,i,o,u=n(1),s=n(5),c=n(0),r=n.n(c),l=n(13),d=n.n(l),f=n(440),m=n(36),b=n(50),h=n(4189),v=n.n(h),O=n(1493),g=n(14),p=n(299),w=n(102),k=n(177),S=n(679),R=12e5,j=Date.now(),T=!1;function E(e){g.b.setDefaultHeader("X-CSRF-Token",e),g.b.setDefaultHeader("X-CSRF-Source","keep-alive-poller"),O.a.setDefaultHeader("X-CSRF-Token",e),O.a.setDefaultHeader("X-CSRF-Source","keep-alive-poller"),Object(w.c)(e),Object(p.a)(e)}function C(e){var t=e.hasRememberMe,n=e.showReauthDialog,u=e.onReauthComplete,s=e.closeDialogIfOpen;function c(e){!t||null!=e&&e.url.includes("/account/callback/ping")?null!=e&&e.url.includes("/lazy")||v(!0):f()}Object(S.f)("PATCH_CSRF_TOKEN_ON_LOGIN",(function(e){var t=e.isSameAccount,n=e.isLoginEvent,a=e.token;t&&n&&a&&(E(a),g.b.isSessionValid=!0,O(),m())})),Object(S.f)("SHOW_REAUTH_ON_LOGOUT",(function(e){var t=e.isSameAccount,n=e.isLogOutEvent;t&&n&&setTimeout(v,5e3)}));function r(e){if(403===e.status||503===e.status){var t,n=null===(t=e.headers)||void 0===t?void 0:t.get("Server");if("AkamaiGHost"===n||"AkamaiNetStorage"===n)return b.Bugsnag.notify("Keep-alive-poller middlewares detected akamai WAF response",(function(e){e.addMetadata("custom",{akamaiWafBlock:!0})})),!0}return!1}Object(S.f)("REDIRECT_TO_LOGIN_ON_ACCOUNT_SWITCH",(function(e){var t,n,a,i,o=e.isSameAccount,u=e.isLogOutEvent;!o&&u&&(g.b.isSessionValid=!0,setTimeout((function(){return window.location.href="/?isCrossTabRedirect=true"}),1e3*(t=2,n=25,a=Math.ceil(t),i=Math.floor(n),Math.floor(Math.random()*(i-a+1)+a))))})),a=g.b.addMiddleware((function(e){return r(e)?(b.Bugsnag.addMetadata("custom",{akamaiWafBlock:!0}),e):function(e){return(null==e?void 0:e.url.includes("mailchimp.com"))||(null==e?void 0:e.url.includes("vip-reports.net"))}(e)||e.ok?(403===e.status&&c(e),200===e.status&&m(),e):(b.Bugsnag.notify("Invalid non MC request detected via http client",(function(t){t.addMetadata("custom",{nonMcRequest:!0,responseUrl:e.url,responseStatus:e.status})})),e)})),i=Object(w.a)((function(e){return r(e)&&b.Bugsnag.addMetadata("custom",{akamaiWafBlock:!0}),200===e.status&&m(),e})),k.a.subscribe("reauth/403",c),k.a.subscribe("fallbackiframe/focus",p);var l=function(e){E(e),Object(S.e)(),u(),T=!1,g.b.isSessionValid=!0,j=Date.now(),m()};k.a.subscribe("reauth/complete",l);var d=null;function f(){d&&clearTimeout(d),d=setTimeout((function(){h(),!document.hidden&&document.hasFocus()&&g.b.get("/account/callback/ping",{},!1).then((function(e){return e.ok?(g.b.isSessionValid=!0,e.json()):Promise.reject()})).then((function(e){e.hasOwnProperty("status")&&"ok"===e.status&&E(e.csrf),g.b.isSessionValid=!0,O(),e.lauSessionEnded&&(window.location="/peaches2"),j=Date.now(),m()})).catch((function(){}))}),300)}function m(){o&&h(),o=setTimeout(f,t?R:1454400)}function h(){clearTimeout(o)}function v(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];g.b.isSessionValid=!1,e&&Object(S.d)(),h(),T=!0,n()}function O(){T=!1,s()}function p(){document.hidden||T||Date.now()>j+R&&f()}return document.addEventListener("visibilitychange",p),window.addEventListener("focus",(function(){p()})),window.addEventListener("mc-route-change",m),m(),function(){h(),a(),i(),k.a.unsubscribe("reauth/complete",l),k.a.unsubscribe("reauth/403",c),k.a.unsubscribe("fallbackiframe/focus",p),document.removeEventListener("visibilitychange",p),window.removeEventListener("mc-route-change",m)}}var y=function(){};t.default=function(e){var t=e.reauthUrl,n=e.hasRememberMe,a=e.personalizedScenario,i=Object(c.useState)(!1),o=Object(s.a)(i,2),l=o[0],h=o[1],O=Object(c.useRef)(null),g="".concat(t,"&reauthSource=1");return Object(c.useEffect)((function(){var e=function(e){var t=window.location,n=t.host,i=t.href,o=i.substring(i.indexOf(n)+n.length),u=o.split("/").filter((function(e){return e.length}));return{dimension53:e,dimension115:o,dimension116:u[0]||"",dimension117:u[1]||"",dimension118:u[2]||"",dimension119:u[3]||"",dimension120:a}};return C({hasRememberMe:n,closeDialogIfOpen:function(){Object(m.a)(document.title,"user logged back in from another tab","reauthentication",e("Resume session")),h(!1),b.Bugsnag.leaveBreadcrumb("The ReauthOverlay is closed after succesfull login in another tab.")},onReauthComplete:function(){Object(m.a)(document.title,"log back in","reauthentication",e("Resume session")),h(!1)},showReauthDialog:function(){Object(m.a)(document.title,"logged out","reauthentication",e("")),h(!0)}})}),[a,n]),r.a.createElement(f.b,{ariaLabel:"Your session expired",isOpen:l,onRequestClose:y,initialFocus:O,className:d()(v.a.reauthOverlay,Object(u.a)({},v.a.overlayOpen,l))},r.a.createElement("iframe",{ref:O,title:"Enter your password",width:"100%",height:"100%",frameBorder:0,src:l?g:void 0}))}},4189:function(e,t,n){e.exports={reauthOverlay:"reauthOverlay-26gof",overlayOpen:"overlayOpen-27fw0"}}}]);
//# sourceMappingURL=509.15c287f933f8afdd8044.js.map